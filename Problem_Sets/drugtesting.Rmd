---
title: "drugtest"
author: 'Special Topics: Multivariate Statistics'
date: 'Last updated: `r Sys.Date()`'
output:
  ioslides_presentation:
    fig_width: 7
    css: styles.css
csl: evolution.csl
bibliography: Multivariate.bib
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(cowplot)
library(readxl)
library(GGally)
library(car)
library(epiDisplay)
```


### Logistic Regression

We will use data on the effects of a drug on fever, blood pressure, and pain.  There are two treatments here: the drug, and a placebo as a control. We want to ask if the drug affects fever, blood pressure, or pain and conversely whether we can predict drug treatment from the change in symptoms. First read in the data (`Drug_test.xlsx`) and make `Treatment` a factor.     

```{r}
M <- read_excel("./data/Drug_test.xlsx")
M$Treatment <- factor(M$Treatment)
str(M)
```

Use `ggscatmat()` to visualize the relationships between our predictors: `Fever`, `BP`, and `Pain`. Color your points by treatment. 

```{r}

ggscatmat(as.data.frame(M), 1:3, color = "Treatment")

```

Fit a generalized linear model using `glm()`, predicting `Treatment` from `Fever`, `BP`, and `Pain`. Specify `family` as binomial to perform a logistic regression. Use 1) `summary()`, 2) `logisitic.display()` from the `eipDisplay` package, and 3) `Anova()`, specifying type III sums of squares to look at the results. What can you conclude?

>

```{r}

fm <- glm(Treatment ~ Fever + BP + Pain, data = M,
          family = "binomial")

summary(fm)

logistic.display(fm)

Anova(fm, type = "III")

```

Plot the probability of placebo vs Fever?

```{r}
ggplot(M, aes(x = Fever,
              y = as.numeric(Treatment) - 1)) + 
  geom_hline(yintercept = 0.5, linetype = "dotted", size = 0.5) +
  geom_point(size = 3) +
  ylab("Probability of Placebo") +
  xlab("Fever") +
  scale_y_continuous(breaks = seq(0, 1, by = 0.1)) + 
  ggtitle("BP = 0; Pain = 0")

```

