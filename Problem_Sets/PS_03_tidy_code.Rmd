---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

In the last problem set, you spent some time cleaning up the spider size dimorphism data using base R functions. This week, we will so some of the same operations, but use functions from the tidyverse. While it is very good to know and be able to use base R functions, the same set of operations can be accomplished using tidy functions.

### Activity

Start by loading the original `Size_Dimprphism.xlsx` file into an R object. Use the original version with the coding errors, not the cleaned version that you exported.

```{r}
## FIXME
M <- read_excel("../data/Size_Dimorphism.xlsx")
```

Counting the numbers of groups is easily accomplished by using the `tally()` function of grouped data. In the next chunk, use `group_by()` to group the data by `Species` and `Sex` and then pipe this result to `tally()`

```{r}
## FIXME
M %>% 
  group_by(Species, Sex) %>% 
  tally()
```

You should be able to easily detect the mis-coded `Sex` variables and spelling errors.

We will fix the `Sex` variable first. Because you currently have a mix of lower and upper case, and we want all uppercase, we can use the built-in `toupper()` function which makes a string all uppercase. There is a similar `tolower()` function. In this chunk, mutate `Sex` using `toupper()`. Overwrite your R object with the output. Then use the same `group_by() %>% tally` code your wrote above to check that you now only have `F` and `M` in the `Sex` column.

```{r}
## FIXME
M <- M %>% 
  mutate(Sex = toupper(Sex)) 

M %>% 
  group_by(Species, Sex) %>% 
  tally()
```

You should now see that just two observations of `Species` are incorrect. There are a few ways to "find and replace" strings in R. The `stringr` package, which is loaded with the tidyverse has a series of functions that start with `str_` to work with strings (find, replace, slice, etc.). We will use `str_replace()` to replace the misspelled names. `str_replace()` has the following basic syntax:

```{r}
zz <- c("x_1", "x_2")
str_replace(zz, "x", "xyz")
```

This code replaces `x` with `zyx`. In the following chunk, overwrite `Species` with a `mutate()`ed version of itself passed through `str_replace()` where you correct the spellings that are incorrect. Then use the same code as above to `tally()` the data and check that the four groups now have 50 observations each.

```{r}
## FIXME
M <- M %>% 
  mutate(Species = str_replace(Species, "Pardosa ramulosa", "Pardosa_ramulosa"),
         Species = str_replace(Species, "Pardosa_ramuloso", "Pardosa_ramulosa")) 
M %>% 
  group_by(Species, Sex) %>% 
  tally()

```


<!-- THIS CHUNK COMMENTED BELOW IS NOT DONE TILL WEEK 3 -->

<!-- ## Data Counts -->

<!-- Another way to get counts by group uses `group_by()` and `tally()`, which are part of tidyverse. `group_by()` splits data by factors (most commonly, but numerics will work as well) and `tally()` adds up the number of observations in each of those groups. -->

<!-- ### Activity -->

<!-- In the chunk below, pipe `M` to `group_by()`, grouping by both species and sex. Then pipe that to `tally()`. `tally()` does not require any arguments when used this way. -->

<!-- ```{r} -->
<!-- #FIXME -->
<!-- M %>% group_by(Species, Sex) %>% tally() -->
<!-- ``` -->

<!-- You should now see 50 observations per sex within species.  -->

<!-- THE COMMENTED CHUNK BELOW ISN"T DONE TILL WEEK 3 -->

<!-- ## Aggregating -->

<!-- Along with the minimum, maximum, and range, two of the simplest and most common descriptive statistics are means and standard deviations. -->

<!-- ### Activity -->

<!-- Calculate the mean and standard deviation for body length for each species per each sex. Use `group_by()` and `summarize()`. You should not have to separate the data into two `data.frame`s. -->

<!-- ```{r} -->
<!-- # FIXME -->
<!-- M %>% group_by(Sex, Species) %>% -->
<!--   summarize(mean(BodyLength), sd(BodyLength)) -->
<!-- ``` -->
